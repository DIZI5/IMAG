{% load static %}
<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <title>Комплектуючі</title>
  <link rel="stylesheet" href="{% static 'css/main.css' %}">
  <link rel="stylesheet" href="{% static 'css/production.css' %}">
  <link rel="icon" href="{% static 'favicon.ico' %}">
</head>
<body>
  <!-- компактна верхня панель -->
  <header class="topbar">
    <h1>
      <a class="btn btn-primary btn-return" href="../">Return</a>
      Комплектуючі
    </h1>
    <a href="{% url 'add_group' %}" class="btn btn-primary">＋ Додати групу</a>
  </header>


  <!-- вьюпорт таблиці заповнює весь екран під топбаром -->
  <div class="table-viewport">
    <table class="table-production">
      <colgroup>
        <col><col><col><col><col><col><col><col><col><col><col>
      </colgroup>
      <thead>
        <tr>
          <th>№ (серійний номер)</th>
          <th>Система</th>
          <th>Підсистема</th>
          <th>Виріб</th>
          <th>Опис</th>
          <th>Виробник</th>
          <th>Модель</th>
          <th>Кількість</th>
          <th>Ціна (євро)</th>
          <th>Контактна особа постачальника, e-mail, tel, site</th>
          <th>Дії</th>
        </tr>
      </thead>
      <tbody>
        {% for group in groups %}
          <!-- Головний пункт (група) -->
          <tr class="group-row">
            <td colspan="1"><b>{{ group.serial_number }}</b></td>
            <td colspan="7">{{ group.name }}</td>
            <td colspan="1">{{ group.subsystems_total }}</td>
            <td colspan="2" style="padding: 0;">
              <div class="group-actions">
                <a href="{% url 'edit_group' group.pk %}" class="btn btn-edit">Редагувати</a>
                <a href="{% url 'add_subsystem' %}?main_group={{ group.pk }}" class="btn btn-primary">＋ Додати підсистему</a>
              </div>
            </td>
          </tr>
          {% for subsystem in group.subsystems.all %}
            <!-- Підсистема -->
            <tr class="subsystem-row">
              <td>{{ subsystem.serial_number }}</td>
              <td>{{ subsystem.system }}</td>
              <td>{{ subsystem.subsystem }}</td>
              <td colspan="5"></td>
              <td><b>{{ subsystem.total_price }}</b></td>
              <td colspan="2" style="padding: 0;">
                <div class="group-actions">
                  <a href="{% url 'edit_subsystem' subsystem.pk %}" class="btn btn-edit">Редагувати</a>
                  <a href="{% url 'add_product' %}?subsystem={{ subsystem.pk }}" class="btn btn-primary">＋ Додати підпункт</a>
                </div>
              </td>
            </tr>
            {% for product in subsystem.products.all %}
              <!-- Підпункт (Product) -->
              <tr class="sub-row">
                <td>{{ product.serial_number }}</td>
                <td colspan="2"></td>
                <td class="cell-clip">
                  <span class="cell-text">{{ product.name }}</span>
                  {% if product.name %}
                  <div class="tooltip" role="tooltip"><div class="tooltip-body">{{ product.name }}</div></div>
                  {% endif %}
                </td>
                <td class="cell-clip">
                  <span class="cell-text">{{ product.description|default_if_none:"" }}</span>
                  {% if product.description %}
                  <div class="tooltip" role="tooltip"><div class="tooltip-body">{{ product.description }}</div></div>
                  {% endif %}
                </td>
                <td class="cell-clip">
                  <span class="cell-text">{{ product.manufacturer|default_if_none:"" }}</span>
                  {% if product.manufacturer %}
                  <div class="tooltip" role="tooltip"><div class="tooltip-body">{{ product.manufacturer }}</div></div>
                  {% endif %}
                </td>
                <td class="cell-clip">
                  <span class="cell-text">{{ product.model|default_if_none:"" }}</span>
                  {% if product.model %}
                  <div class="tooltip" role="tooltip"><div class="tooltip-body">{{ product.model }}</div></div>
                  {% endif %}
                </td>
                <td>{{ product.stock }}</td>
                <td>{{ product.price }}</td>
                <td class="cell-clip">
                  <span class="cell-text">{{ product.supplier_contact|default_if_none:"" }}</span>
                  {% if product.supplier_contact %}
                  <div class="tooltip" role="tooltip"><div class="tooltip-body">{{ product.supplier_contact }}</div></div>
                  {% endif %}
                </td>
                <td colspan="1" style="padding: 0;">
                  <div class="actions">
                    <a href="{% url 'edit_product' product.pk %}" class="btn btn-edit">Редагувати</a>
                  </div>
                </td>
              </tr>
            {% endfor %}
          {% endfor %}
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- ПРИКРІПЛЕНИЙ ПІДСУМОК -->
  <div class="summary-bar" aria-live="polite">
    <table class="table-production table-summary" aria-label="Підсумок">
      <colgroup>
        <col><col><col><col><col><col><col><col><col><col><col>
      </colgroup>
      <tbody>
        <tr>
          <td class="summary-label" colspan="3">Підсумок</td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <!-- ∑ Ціна -->
          <td class="summary-value">
            <span id="sum-price">
              € {{ total_sum }}
            </span>
          </td>
          <!-- Контакти (порожньо) -->
          <td></td>
          <!-- Дії (порожньо) -->
          <td>
            <span>//дія//</span>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <script src="{% static 'js/tooltips.js' %}"></script>

  {% if messages %}
  <div id="toast-root" class="toast-root" aria-live="polite" aria-atomic="true">
    {% for message in messages %}
      <div class="toast {{ message.tags|default:'info' }}" role="status">
        <div class="toast-msg">{{ message }}</div>
      </div>
    {% endfor %}
  </div>
  {% endif %}

  <script src="{% static 'js/flash.js' %}"></script>
  <script src="{% static 'js/sum-price.js' %}"></script>
</body>
</html>